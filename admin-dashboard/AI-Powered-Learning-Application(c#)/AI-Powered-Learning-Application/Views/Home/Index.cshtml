@using AI_Powered_Learning_Application.Controllers
@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="dashboard-cards">
    <div class="dashboard-card">
        <img src="~/images/students.png" alt="Students" style="width: 50px; margin-bottom: 10px;" />
        <h3>@Model.StudentCount Registered Students</h3>
        <a href="@Url.Action("Index", "Student")" style="text-decoration: none; color: inherit;">
            <p>More info <i class="fas fa-chevron-right"></i></p>
        </a>
    </div>

    <div class="dashboard-card">
        <img src="~/images/books.png" alt="Courses" style="width: 50px; margin-bottom: 10px;" />
        <h3>@Model.CourseCount Available Courses</h3>
        <a href="@Url.Action("Index", "ManageCourse")" style="text-decoration: none; color: inherit;">
            <p>More info <i class="fas fa-chevron-right"></i></p>
        </a>
    </div>
</div>

<div class="calendar">
    <div class="calendar-header">
        <button id="prev-month" class="calendar-nav-btn"><i class="fas fa-chevron-left"></i></button>
        <h4 id="current-month-year">@DateTime.Now.ToString("MMMM yyyy")</h4>
        <button id="next-month" class="calendar-nav-btn"><i class="fas fa-chevron-right"></i></button>
    </div>
    <table class="table table-bordered" id="calendar-table">
        <thead>
            <tr id="calendar-header-row">
                <!-- Day headers will be added by JavaScript -->
            </tr>
        </thead>
        <tbody id="calendar-body">
            <!-- Calendar dates will be generated by JavaScript -->
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let currentDate = new Date();

            // Initialize calendar
            renderCalendar(currentDate);

            // Navigation buttons
            document.getElementById('prev-month').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar(currentDate);
            });

            document.getElementById('next-month').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar(currentDate);
            });

            function renderCalendar(date) {
                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];

                // Update month/year display
                document.getElementById('current-month-year').textContent =
                    `${monthNames[date.getMonth()]} ${date.getFullYear()}`;

                // Get first day of month and total days in month
                const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
                const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();

                // Get day of week for first day (0 = Sunday, 6 = Saturday)
                const startingDay = firstDay.getDay();

                // Set up day headers
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const headerRow = document.getElementById('calendar-header-row');
                headerRow.innerHTML = '';

                dayNames.forEach(day => {
                    const th = document.createElement('th');
                    th.textContent = day;
                    headerRow.appendChild(th);
                });

                // Clear previous calendar dates
                const calendarBody = document.getElementById('calendar-body');
                calendarBody.innerHTML = '';

                let dateCount = 1;
                let today = new Date();

                // Create 6 rows (weeks) to ensure all dates fit
                for (let i = 0; i < 6; i++) {
                    // Stop if we've displayed all days
                    if (dateCount > daysInMonth) break;

                    const row = document.createElement('tr');

                    // Create 7 cells (days) for each row
                    for (let j = 0; j < 7; j++) {
                        const cell = document.createElement('td');

                        if (i === 0 && j < startingDay) {
                            // Days from previous month
                            const prevMonthDays = new Date(date.getFullYear(), date.getMonth(), 0).getDate();
                            cell.textContent = prevMonthDays - (startingDay - j - 1);
                            cell.classList.add('other-month');
                        } else if (dateCount > daysInMonth) {
                            // Days from next month
                            cell.textContent = dateCount - daysInMonth;
                            cell.classList.add('other-month');
                            dateCount++;
                        } else {
                            // Current month days
                            cell.textContent = dateCount;

                            // Highlight today
                            if (dateCount === today.getDate() &&
                                date.getMonth() === today.getMonth() &&
                                date.getFullYear() === today.getFullYear()) {
                                cell.classList.add('today');
                            }

                            dateCount++;
                        }

                        row.appendChild(cell);
                    }

                    calendarBody.appendChild(row);
                }
            }
        });
    </script>
}